<!--
  ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
  ‚ïë                    B·∫¢N QUY·ªÄN THU·ªòC V·ªÄ                        ‚ïë
  ‚ïë                   NGUY·ªÑN TU·∫§N ANH                            ‚ïë
  ‚ïë                                                              ‚ïë
  ‚ïë  ¬© 2024-2025 All Rights Reserved                             ‚ïë
  ‚ïë  Zalo: 0559629469                                            ‚ïë
  ‚ïë                                                              ‚ïë
  ‚ïë  NGHI√äM C·∫§M SAO CH√âP, PH√ÇN PH·ªêI HO·∫∂C S·ª¨ D·ª§NG                 ‚ïë
  ‚ïë  M√Ä KH√îNG C√ì S·ª∞ CHO PH√âP C·ª¶A T√ÅC GI·∫¢                         ‚ïë
  ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
-->
<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>B·∫£ng Gi√° D·ªãch V·ª• | L√™n ƒêi·ªÉm CMT</title>
    <meta
      name="description"
      content="B·∫£ng gi√° d·ªãch v·ª• tƒÉng t∆∞∆°ng t√°c - View, Like, Comment, Share, Follow"
    />

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Poppins:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!-- Star Particle Background (Canvas) -->
    <canvas id="starfield" aria-hidden="true"></canvas>

    <!-- Animated Gradient Overlay -->
    <div class="gradient-bg" aria-hidden="true"></div>

    <!-- Main Content -->
    <main class="main-container">
      <!-- Menu Card -->
      <article class="menu-card">
        <!-- Header -->
        <header class="card-header">
          <h1 class="card-title">L√™n ƒêi·ªÉm CMT v1, v2</h1>
          <p class="card-subtitle">(t√≠nh c·∫£ v ghim) c√≥ nh·∫≠n ƒëƒÉng l·∫°i ·∫°</p>
          <a href="combo.html" class="nav-button"
            >üì¶ B·∫£ng gi√° chuy·ªÉn kho·∫£n ngo√†i</a
          >
          <a href="history.html" class="nav-button history-btn"
            >üìã L·ªãch s·ª≠ giao d·ªãch</a
          >
        </header>

        <!-- Menu List - Dynamic from API -->
        <nav aria-label="Danh s√°ch d·ªãch v·ª•">
          <ul class="menu-list" role="list" id="menuList">
            <li class="menu-item" style="text-align: center; opacity: 0.7;">
              <span class="item-text">‚è≥ ƒêang t·∫£i d·ªãch v·ª•...</span>
            </li>
          </ul>
        </nav>

        <!-- Bank Info -->
        <div class="bank-info">
          <h3 class="bank-title">üí≥ Th√¥ng tin chuy·ªÉn kho·∫£n</h3>
          <div class="bank-qr">
            <img src="img/qr.jpg" alt="QR Code" class="qr-image" id="qrImage" />
          </div>
          <div class="bank-details">
            <p class="bank-number" id="bankNumber" data-stk="0325687430">
              STK: <strong>0325687430</strong>
              <span class="copy-btn" id="copyStk">üìã</span>
            </p>
            <p class="bank-name">Nguy·ªÖn Tu·∫•n Anh</p>
          </div>
          <p class="copy-toast" id="copyToast">‚úÖ ƒê√£ sao ch√©p!</p>
        </div>

        <!-- QR Lightbox -->
        <div class="qr-lightbox" id="qrLightbox">
          <img src="img/qr.jpg" alt="QR Code" class="qr-lightbox-image" />
        </div>

        <!-- Footer -->
        <footer class="card-footer">
          <div class="footer-content">
            <a
              href="https://zalo.me/0559629469"
              target="_blank"
              class="zalo-contact"
            >
              <img
                src="https://upload.wikimedia.org/wikipedia/commons/9/91/Icon_of_Zalo.svg"
                alt="Zalo"
                style="width: 24px; height: 24px"
              />
              <span>Zalo: 0559629469</span>
            </a>
            <p class="zalo-contact">
              <a
                href="https://www.facebook.com/tuananhh111/"
                target="_blank"
                style="
                  display: flex;
                  align-items: center;
                  gap: 8px;
                  text-decoration: none;
                  color: inherit;
                "
              >
                <img
                  src="https://upload.wikimedia.org/wikipedia/commons/5/51/Facebook_f_logo_%282019%29.svg"
                  alt="Facebook"
                  style="width: 24px; height: 24px"
                />
                <span>Facebook: Tu·∫•n Anh</span>
              </a>
            </p>
            <p class="copyright-text">
              <span class="copyright-icon">¬©</span>
              <span class="copyright-label">B·∫£n quy·ªÅn thu·ªôc v·ªÅ</span>
              <span class="copyright-name">TU·∫§N ANH</span>
            </p>
          </div>
          <button
            class="effects-toggle"
            id="effectsToggle"
            aria-label="B·∫≠t/t·∫Øt hi·ªáu ·ª©ng n·ªÅn"
            aria-pressed="true"
            title="B·∫≠t/t·∫Øt hi·ªáu ·ª©ng"
          >
            ‚ú®
          </button>
        </footer>
      </article>
    </main>

    <div class="popup-overlay" id="popupOverlay">
      <div class="popup-modal">
        <button class="popup-close" id="popupClose" aria-label="ƒê√≥ng">√ó</button>
        <h3 class="popup-title" id="popupTitle">Chi ti·∫øt</h3>
        <p class="popup-info" id="popupInfo">Th√¥ng tin chi ti·∫øt</p>
      </div>
    </div>


    <!-- Order Form Modal -->
    <div class="order-form-overlay" id="orderFormOverlay">
      <div class="order-form-modal">
        <button class="order-form-close" id="orderFormClose">√ó</button>
        <h3 class="order-form-title">üìù ƒê·∫∑t D·ªãch V·ª•</h3>
        <form id="orderForm">
          <div class="form-group">
            <label for="customerName">T√™n c·ªßa b·∫°n *</label>
            <input
              type="text"
              id="customerName"
              name="customerName"
              placeholder="Nh·∫≠p t√™n..."
              required
            />
          </div>
          <div class="form-group" id="phoneGroup">
            <label for="customerPhone" id="phoneLabel"
              >S·ªë ƒëi·ªán tho·∫°i
              <span class="form-hint">(d√πng Zalo s·ªë n√†y)</span></label
            >
            <input
              type="tel"
              id="customerPhone"
              name="customerPhone"
              placeholder="Nh·∫≠p SƒêT Zalo..."
            />
          </div>
          <div class="form-group">
            <label>Lo·∫°i d·ªãch v·ª• *</label>
            <div class="custom-dropdown" id="categoryDropdown">
              <div class="dropdown-selected" data-value="">-- ƒêang t·∫£i... --</div>
              <div class="dropdown-options" id="categoryOptions">
                <!-- Loaded from API -->
              </div>
            </div>
            <input
              type="hidden"
              id="serviceCategory"
              name="serviceCategory"
              required
            />
          </div>
          <div class="form-group" id="serviceTypeGroup" style="display: none">
            <label>Ch·ªçn d·ªãch v·ª• *</label>
            <div class="custom-dropdown" id="serviceDropdown">
              <div class="dropdown-selected" data-value="">-- Ch·ªçn --</div>
              <div class="dropdown-options" id="serviceOptions"></div>
            </div>
            <input type="hidden" id="serviceType" name="serviceType" />
          </div>
          <!-- Combo Details -->
          <div
            class="combo-details-section"
            id="comboDetailsSection"
            style="display: none"
          >
            <div class="combo-details-header">
              <span class="combo-details-title">üì¶ Chi ti·∫øt combo</span>
              <button
                type="button"
                class="combo-details-toggle"
                id="comboDetailsToggle"
              >
                Thu g·ªçn ‚ñ≤
              </button>
            </div>
            <div class="combo-details-content" id="comboDetailsContent">
              <ul class="combo-details-list" id="comboDetailsList"></ul>
            </div>
          </div>
          <div class="form-group">
            <label for="orderNote">Ghi ch√∫ (link video, y√™u c·∫ßu...)</label>
            <textarea
              id="orderNote"
              name="orderNote"
              placeholder="Nh·∫≠p link video ho·∫∑c ghi ch√∫..."
              rows="3"
            ></textarea>
          </div>
          <button type="submit" class="order-submit-btn">
            üöÄ G·ª≠i ƒê∆°n H√†ng
          </button>
        </form>
        <p class="order-form-note">
          * Sau khi g·ª≠i, vui l√≤ng chuy·ªÉn kho·∫£n theo th√¥ng tin b√™n d∆∞·ªõi
        </p>
      </div>
    </div>

    <!-- Order Button -->
    <button class="order-fab" id="orderFab" title="ƒê·∫∑t d·ªãch v·ª•">üõí</button>

    <!-- Orders List Section -->
    <div class="orders-panel" id="ordersPanel">
      <div class="orders-panel-header">
        <h4>üìã ƒê∆°n H√†ng G·∫ßn ƒê√¢y</h4>
        <div style="display: flex; gap: 8px; align-items: center">
          <a
            href="history.html"
            style="
              font-size: 0.7rem;
              color: var(--neon-cyan);
              text-decoration: none;
            "
            >Xem t·∫•t c·∫£ ‚Üí</a
          >
          <button class="orders-panel-close" id="ordersPanelClose">√ó</button>
        </div>
      </div>
      <div class="orders-list" id="ordersList">
        <p class="no-orders">Ch∆∞a c√≥ ƒë∆°n h√†ng n√†o</p>
      </div>
    </div>

    <!-- Order Management Script (Neon PostgreSQL via Netlify Functions) -->
    <script type="module">
      // DOM Elements
      const menuList = document.getElementById("menuList");
      const orderForm = document.getElementById("orderForm");
      const orderFormOverlay = document.getElementById("orderFormOverlay");
      const orderFormClose = document.getElementById("orderFormClose");
      const orderFab = document.getElementById("orderFab");
      const ordersPanel = document.getElementById("ordersPanel");
      const ordersPanelClose = document.getElementById("ordersPanelClose");
      const ordersList = document.getElementById("ordersList");
      const serviceCategoryInput = document.getElementById("serviceCategory");
      const serviceTypeGroup = document.getElementById("serviceTypeGroup");
      const serviceTypeInput = document.getElementById("serviceType");
      const categoryDropdown = document.getElementById("categoryDropdown");
      const serviceDropdown = document.getElementById("serviceDropdown");
      const serviceOptionsContainer = document.getElementById("serviceOptions");
      const comboDetailsSection = document.getElementById(
        "comboDetailsSection"
      );
      const comboDetailsList = document.getElementById("comboDetailsList");
      const comboDetailsToggle = document.getElementById("comboDetailsToggle");
      const comboDetailsContent = document.getElementById(
        "comboDetailsContent"
      );

      // Load menu services from API
      async function loadMenuServices() {
        try {
          const response = await fetch('/.netlify/functions/services');
          const services = await response.json();
          
          if (!services || services.length === 0) {
            menuList.innerHTML = `
              <li class="menu-item" style="text-align: center; opacity: 0.7;">
                <span class="item-text">üì≠ Ch∆∞a c√≥ d·ªãch v·ª• n√†o</span>
              </li>
            `;
            return;
          }
          
          // Render menu items
          menuList.innerHTML = services.map((service, index) => {
            let html = '';
            
            // Add divider except for first item
            if (index > 0) {
              html += '<li class="divider" aria-hidden="true"></li>';
            }
            
            html += `
              <li class="menu-item" 
                  data-qty="${service.qty || 1}" 
                  data-tooltip="${service.name}" 
                  data-info="${service.description || ''}"
                  tabindex="0">
                ${service.is_hot ? '<span class="badge-hot">üî• HOT</span>' : ''}
                <span class="item-qty">${service.qty || 1}</span>
                ${service.icon_url ? `
                  <span class="item-icon" aria-hidden="true">
                    <img src="${service.icon_url}" alt="" style="width: 28px; height: 28px; object-fit: contain" />
                  </span>
                ` : '<span class="item-icon">üì¶</span>'}
                <span class="item-text">${service.name}</span>
                ${service.badges ? `
                  <span class="item-badges">${service.badges}</span>
                ` : ''}
              </li>
            `;
            
            return html;
          }).join('');
          
          // Menu loaded successfully - order form options remain hardcoded (free/combo)
          
          // Fix visibility for dynamically added items (CSS animation sets opacity:0 by default)
          setTimeout(() => {
            menuList.querySelectorAll('.menu-item').forEach(item => {
              item.style.opacity = '1';
              item.style.transform = 'none';
              
              // Attach click handler for popup
              item.addEventListener('click', function(e) {
                const info = this.dataset.info;
                const popupOverlay = document.getElementById('popupOverlay');
                const popupTitle = document.getElementById('popupTitle');
                const popupInfo = document.getElementById('popupInfo');
                
                if (popupOverlay && info) {
                  const itemText = this.querySelector('.item-text')?.textContent || 'Chi ti·∫øt';
                  popupTitle.textContent = itemText;
                  popupInfo.innerHTML = info;
                  popupOverlay.classList.add('active');
                }
                
                // Ripple effect
                const ripple = document.createElement('span');
                ripple.style.cssText = `
                  position: absolute;
                  background: rgba(255, 107, 157, 0.3);
                  border-radius: 50%;
                  transform: scale(0);
                  animation: ripple 0.6s ease-out forwards;
                  pointer-events: none;
                `;
                const rect = this.getBoundingClientRect();
                const size = Math.max(rect.width, rect.height);
                ripple.style.width = ripple.style.height = size + 'px';
                ripple.style.left = (e.clientX - rect.left - size / 2) + 'px';
                ripple.style.top = (e.clientY - rect.top - size / 2) + 'px';
                this.appendChild(ripple);
                setTimeout(() => ripple.remove(), 600);
              });
            });
          }, 100);
          
        } catch (error) {
          console.error('Error loading services:', error);
          menuList.innerHTML = `
            <li class="menu-item" style="text-align: center; color: #ff6b6b;">
              <span class="item-text">‚ùå Kh√¥ng th·ªÉ t·∫£i d·ªãch v·ª•</span>
            </li>
          `;
        }
      }
      
      // Load menu on page load
      loadMenuServices();

      // Service options data - loaded from API
      let serviceOptionsData = {};
      let comboDetailsData = {};
      let allCategories = [];

      // Load categories from API
      async function loadCategoriesForForm() {
        try {
          const response = await fetch('/.netlify/functions/categories');
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          allCategories = await response.json();
          
          // Build serviceOptionsData and comboDetailsData from API
          allCategories.forEach(cat => {
            serviceOptionsData[cat.code] = (cat.options || []).map(opt => ({
              value: opt.name,
              label: opt.label
            }));
            
            // Build combo details
            (cat.options || []).forEach(opt => {
              if (opt.details) {
                try {
                  comboDetailsData[opt.name] = JSON.parse(opt.details);
                } catch(e) {}
              }
            });
          });
          
          const categoryOptions = document.getElementById('categoryOptions');
          const categorySelected = categoryDropdown.querySelector('.dropdown-selected');
          
          if (allCategories.length > 0) {
            categoryOptions.innerHTML = allCategories.map(cat => 
              `<div class="dropdown-option" data-value="${cat.code}">${cat.icon || 'üì¶'} ${cat.name}</div>`
            ).join('');
            categorySelected.textContent = '-- Ch·ªçn --';
            
            // Re-init dropdown to attach event listeners (with small delay to ensure DOM is ready)
            setTimeout(() => {
              initCategoryDropdownAfterLoad();
            }, 50);
          } else {
            console.warn('No categories found!');
            if (categorySelected) categorySelected.textContent = 'Kh√¥ng c√≥ lo·∫°i d·ªãch v·ª•';
          }
        } catch (error) {
          console.error('Error loading categories:', error);
          const categorySelected = categoryDropdown?.querySelector('.dropdown-selected');
          if (categorySelected) {
            categorySelected.textContent = 'L·ªói t·∫£i d·ªØ li·ªáu';
          }
        }
      }
      
      // Load categories on page load
      loadCategoriesForForm();

      // Toggle combo details
      comboDetailsToggle.addEventListener("click", () => {
        comboDetailsContent.classList.toggle("collapsed");
        comboDetailsToggle.textContent = comboDetailsContent.classList.contains(
          "collapsed"
        )
          ? "M·ªü r·ªông ‚ñº"
          : "Thu g·ªçn ‚ñ≤";
      });

      // Custom dropdown functionality
      function initDropdown(dropdown, hiddenInput, onChange) {
        const selected = dropdown.querySelector(".dropdown-selected");
        const options = dropdown.querySelectorAll(".dropdown-option");

        selected.addEventListener("click", (e) => {
          e.stopPropagation();
          // Close other dropdowns
          document.querySelectorAll(".custom-dropdown.open").forEach((d) => {
            if (d !== dropdown) d.classList.remove("open");
          });
          dropdown.classList.toggle("open");
        });

        options.forEach((option) => {
          option.addEventListener("click", () => {
            const value = option.dataset.value;
            const text = option.textContent;
            selected.textContent = text;
            selected.dataset.value = value;
            hiddenInput.value = value;
            dropdown.classList.remove("open");
            options.forEach((o) => o.classList.remove("selected"));
            option.classList.add("selected");
            if (onChange) onChange(value);
          });
        });
      }

      // Close dropdowns when clicking outside
      document.addEventListener("click", () => {
        document.querySelectorAll(".custom-dropdown.open").forEach((d) => {
          d.classList.remove("open");
        });
      });

      // Function to init category dropdown after dynamic load
      function initCategoryDropdownAfterLoad() {
        const selected = categoryDropdown.querySelector(".dropdown-selected");
        const options = categoryDropdown.querySelectorAll(".dropdown-option");
        
        selected.addEventListener("click", (e) => {
          e.stopPropagation();
          document.querySelectorAll(".custom-dropdown.open").forEach((d) => {
            if (d !== categoryDropdown) d.classList.remove("open");
          });
          categoryDropdown.classList.toggle("open");
        });
        
        options.forEach((option) => {
          option.addEventListener("click", () => {
            const value = option.dataset.value;
            const text = option.textContent;
            selected.textContent = text;
            selected.dataset.value = value;
            serviceCategoryInput.value = value;
            categoryDropdown.classList.remove("open");
            options.forEach((o) => o.classList.remove("selected"));
            option.classList.add("selected");
            
            // Handle category change
            if (value && serviceOptionsData[value]) {
              serviceTypeGroup.style.display = "block";
              // Populate service options
              serviceOptionsContainer.innerHTML = serviceOptionsData[value]
                .map((opt) => `<div class="dropdown-option" data-value="${opt.value}">${opt.label}</div>`)
                .join("");
              // Reset service dropdown
              const serviceSelected = serviceDropdown.querySelector(".dropdown-selected");
              serviceSelected.textContent = "-- Ch·ªçn --";
              serviceSelected.dataset.value = "";
              serviceTypeInput.value = "";
              // Hide combo details
              comboDetailsSection.style.display = "none";
              // Re-init service dropdown
              initServiceDropdownAfterCategoryChange();
              
              // Phone required only for combo
              const phoneInput = document.getElementById('customerPhone');
              const phoneLabel = document.getElementById('phoneLabel');
              if (value === 'combo') {
                phoneInput.required = true;
                phoneInput.placeholder = 'Nh·∫≠p SƒêT Zalo...';
                phoneLabel.innerHTML = 'S·ªë ƒëi·ªán tho·∫°i * <span class="form-hint">(d√πng Zalo s·ªë n√†y)</span>';
              } else {
                phoneInput.required = false;
                phoneInput.placeholder = 'Nh·∫≠p SƒêT Zalo (n·∫øu c√≥)...';
                phoneLabel.innerHTML = 'S·ªë ƒëi·ªán tho·∫°i <span class="form-hint">(n·∫øu c√≥)</span>';
              }
            } else {
              serviceTypeGroup.style.display = "none";
              comboDetailsSection.style.display = "none";
            }
          });
        });
      }
      
      // Function to init service dropdown after category change
      // Only attach handlers to options (the click handler for opening dropdown is already set below)
      function initServiceDropdownAfterCategoryChange() {
        const options = serviceDropdown.querySelectorAll(".dropdown-option");
        console.log('initServiceDropdownAfterCategoryChange - options:', options.length);
        
        options.forEach((option) => {
          option.addEventListener("click", () => {
            const value = option.dataset.value;
            const text = option.textContent;
            const selected = serviceDropdown.querySelector(".dropdown-selected");
            selected.textContent = text;
            selected.dataset.value = value;
            serviceTypeInput.value = value;
            serviceDropdown.classList.remove("open");
            options.forEach((o) => o.classList.remove("selected"));
            option.classList.add("selected");
            
            // Show combo details if available
            if (comboDetailsData[value]) {
              comboDetailsSection.style.display = "block";
              comboDetailsContent.innerHTML = comboDetailsData[value]
                .map((item) => `<li>${item}</li>`)
                .join("");
            } else {
              comboDetailsSection.style.display = "none";
            }
          });
        });
      }
      // NOTE: categoryDropdown is now initialized dynamically by initCategoryDropdownAfterLoad()
      // after categories are loaded from API

      // Service dropdown click
      serviceDropdown
        .querySelector(".dropdown-selected")
        .addEventListener("click", (e) => {
          e.stopPropagation();
          document.querySelectorAll(".custom-dropdown.open").forEach((d) => {
            if (d !== serviceDropdown) d.classList.remove("open");
          });
          serviceDropdown.classList.toggle("open");
        });

      // Open/Close Order Form
      orderFab.addEventListener("click", () => {
        orderFormOverlay.classList.add("active");
      });

      orderFormClose.addEventListener("click", () => {
        orderFormOverlay.classList.remove("active");
      });

      orderFormOverlay.addEventListener("click", (e) => {
        if (e.target === orderFormOverlay) {
          orderFormOverlay.classList.remove("active");
        }
      });

      ordersPanelClose.addEventListener("click", () => {
        ordersPanel.classList.remove("active");
      });

      // Submit Order - Now using Netlify Functions API
      orderForm.addEventListener("submit", async (e) => {
        e.preventDefault();

        // Validate required fields
        const name = document.getElementById("customerName").value.trim();
        const phone = document.getElementById("customerPhone").value.trim();
        const category = document.getElementById("serviceCategory").value;
        const service = document.getElementById("serviceType").value;

        if (!name) {
          alert("‚ùå Vui l√≤ng nh·∫≠p t√™n c·ªßa b·∫°n!");
          return;
        }
        const phoneInput = document.getElementById("customerPhone");
        if (phoneInput.required && !phone) {
          alert("‚ùå Vui l√≤ng nh·∫≠p s·ªë ƒëi·ªán tho·∫°i!");
          return;
        }
        if (!category) {
          alert("‚ùå Vui l√≤ng ch·ªçn lo·∫°i d·ªãch v·ª•!");
          return;
        }
        if (!service) {
          alert("‚ùå Vui l√≤ng ch·ªçn d·ªãch v·ª• c·ª• th·ªÉ!");
          return;
        }

        const note = document.getElementById("orderNote").value.trim();
        if (!note) {
          alert("‚ùå Vui l√≤ng nh·∫≠p link video v√†o ghi ch√∫!");
          return;
        }
        if (!note.includes("tiktok.com")) {
          alert("‚ùå Link ph·∫£i l√† link TikTok (https://www.tiktok.com/...)");
          return;
        }

        const orderData = {
          name: name,
          phone: phone,
          category: category,
          service: service,
          note: note,
        };

        try {
          // Call Netlify Function API
          const response = await fetch('/.netlify/functions/orders', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(orderData)
          });

          if (!response.ok) {
            throw new Error('Failed to create order');
          }

          // Reset form and hide service type
          orderForm.reset();
          serviceTypeGroup.style.display = "none";
          // Reset dropdowns
          categoryDropdown.querySelector(".dropdown-selected").textContent = "-- Ch·ªçn --";
          categoryDropdown.querySelector(".dropdown-selected").dataset.value = "";
          serviceDropdown.querySelector(".dropdown-selected").textContent = "-- Ch·ªçn --";
          serviceDropdown.querySelector(".dropdown-selected").dataset.value = "";
          comboDetailsSection.style.display = "none";
          orderFormOverlay.classList.remove("active");

          // Show success message
          alert(
            "‚úÖ ƒê√£ g·ª≠i ƒë∆°n h√†ng th√†nh c√¥ng! Vui l√≤ng chuy·ªÉn kho·∫£n theo th√¥ng tin tr√™n trang."
          );
          
          // Reload orders
          loadOrders();
        } catch (error) {
          console.error("Error:", error);
          alert("‚ùå C√≥ l·ªói x·∫£y ra. Vui l√≤ng th·ª≠ l·∫°i!");
        }
      });

      // Load Orders from API
      async function loadOrders() {
        try {
          const response = await fetch('/.netlify/functions/orders');
          const orders = await response.json();

          // Render orders (only show name, service, status - no phone/note for privacy)
          if (!orders || orders.length === 0) {
            ordersList.innerHTML =
              '<p class="no-orders">Ch∆∞a c√≥ ƒë∆°n h√†ng n√†o</p>';
          } else {
            ordersList.innerHTML = orders
              .slice(0, 10)
              .map(
                (order) => `
              <div class="order-item ${order.status}">
                <div class="order-item-header">
                  <span class="order-name">${order.customer_name}</span>
                  <span class="order-status">${
                    order.status === "pending" ? "‚è≥ Ch·ªù x·ª≠ l√Ω" : "‚úÖ ƒê√£ xong"
                  }</span>
                </div>
                <div class="order-service">${order.service_type}</div>
                <div class="order-time">${new Date(
                  order.created_at
                ).toLocaleString("vi-VN")}</div>
              </div>
            `
              )
              .join("");
          }
        } catch (error) {
          console.error("Error loading orders:", error);
          ordersList.innerHTML =
            '<p class="no-orders">Kh√¥ng th·ªÉ t·∫£i ƒë∆°n h√†ng</p>';
        }
      }

      // Load orders on page load
      loadOrders();
      
      // Refresh orders every 30 seconds
      setInterval(loadOrders, 30000);
    </script>

    <script src="script.js"></script>
  </body>
</html>
