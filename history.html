<!--
  ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
  ‚ïë                    B·∫¢N QUY·ªÄN THU·ªòC V·ªÄ                        ‚ïë
  ‚ïë                   NGUY·ªÑN TU·∫§N ANH                            ‚ïë
  ‚ïë  ¬© 2024-2025 All Rights Reserved                             ‚ïë
  ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
-->
<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>L·ªãch S·ª≠ ƒê∆°n H√†ng</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="styles.css" />
    <style>
      .history-container {
        position: relative;
        z-index: 10;
        max-width: 600px;
        margin: 0 auto;
        padding: 20px;
        min-height: 100vh;
      }

      .history-card {
        background: var(--card-bg);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border-radius: var(--radius-lg);
        border: 1px solid var(--card-border);
        box-shadow: var(--shadow-soft);
        padding: 20px;
        margin-bottom: 20px;
      }

      .history-header {
        text-align: center;
        margin-bottom: 25px;
      }

      .history-title {
        font-size: 1.5rem;
        color: var(--text-white);
        margin-bottom: 10px;
      }

      .history-subtitle {
        font-size: 0.85rem;
        color: var(--text-muted);
      }

      .back-btn {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 10px 20px;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid var(--card-border);
        border-radius: var(--radius-full);
        color: var(--text-white);
        text-decoration: none;
        font-size: 0.85rem;
        margin-bottom: 20px;
        transition: all 0.2s;
      }

      .back-btn:hover {
        background: rgba(255, 107, 157, 0.2);
        border-color: var(--neon-pink);
      }

      .orders-container {
        display: flex;
        flex-direction: column;
        gap: 15px;
      }

      .order-card {
        background: var(--card-bg);
        border: 1px solid var(--card-border);
        border-radius: var(--radius-md);
        padding: 15px;
        transition: all 0.2s;
      }

      .order-card:hover {
        border-color: var(--neon-pink);
      }

      .order-card.pending {
        border-left: 3px solid #ffc107;
      }

      .order-card.completed {
        border-left: 3px solid #00c853;
      }

      .order-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }

      .order-customer {
        font-weight: 600;
        color: var(--text-white);
        font-size: 1rem;
      }

      .order-status-badge {
        padding: 4px 10px;
        border-radius: var(--radius-full);
        font-size: 0.7rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
      }

      .order-status-badge.pending {
        background: rgba(255, 193, 7, 0.2);
        color: #ffc107;
      }

      .order-status-badge.completed {
        background: rgba(0, 200, 83, 0.2);
        color: #00c853;
      }

      .order-status-badge:hover {
        transform: scale(1.05);
      }

      .order-info {
        display: grid;
        gap: 8px;
      }

      .order-info-row {
        display: flex;
        justify-content: space-between;
        font-size: 0.85rem;
      }

      .order-info-label {
        color: var(--text-muted);
      }

      .order-info-value {
        color: var(--text-white);
        text-align: right;
        max-width: 60%;
        word-break: break-word;
      }

      .order-info-value.highlight {
        color: var(--neon-cyan);
      }

      .order-note {
        margin-top: 10px;
        padding: 8px;
        background: rgba(255, 255, 255, 0.03);
        border-radius: var(--radius-sm);
        font-size: 0.8rem;
        color: var(--text-muted);
      }

      .order-time {
        font-size: 0.75rem;
        color: var(--text-muted);
        margin-top: 10px;
        text-align: right;
      }

      .loading {
        text-align: center;
        padding: 40px;
        color: var(--text-muted);
      }

      .no-orders {
        text-align: center;
        padding: 40px;
        color: var(--text-muted);
      }

      .stats-bar {
        display: flex;
        gap: 15px;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }

      .stat-item {
        flex: 1;
        min-width: 100px;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid var(--card-border);
        border-radius: var(--radius-sm);
        padding: 12px;
        text-align: center;
      }

      .stat-number {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--neon-cyan);
      }

      .stat-label {
        font-size: 0.7rem;
        color: var(--text-muted);
        margin-top: 4px;
      }

      .filter-bar {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
      }

      .filter-btn {
        flex: 1;
        padding: 10px;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid var(--card-border);
        border-radius: var(--radius-sm);
        color: var(--text-muted);
        font-size: 0.8rem;
        cursor: pointer;
        transition: all 0.2s;
      }

      .filter-btn.active {
        background: rgba(255, 107, 157, 0.2);
        border-color: var(--neon-pink);
        color: var(--neon-pink);
      }

      .filter-btn:hover {
        border-color: var(--neon-pink);
      }
    </style>
  </head>
  <body>
    <!-- Star Particle Background (Canvas) -->
    <canvas id="starfield" aria-hidden="true"></canvas>

    <!-- Animated Gradient Overlay -->
    <div class="gradient-bg" aria-hidden="true"></div>

    <div class="history-container">
      <!-- Back Button -->
      <a href="index.html" class="back-btn">‚Üê Quay l·∫°i</a>

      <!-- History Card -->
      <div class="history-card">
        <!-- Header -->
        <div class="history-header">
          <h1 class="history-title">üìã L·ªãch S·ª≠ ƒê∆°n H√†ng</h1>
          <p class="history-subtitle">Qu·∫£n l√Ω v√† theo d√µi ƒë∆°n h√†ng</p>
        </div>

        <!-- Stats -->
        <div class="stats-bar">
          <div class="stat-item">
            <div class="stat-number" id="totalOrders">0</div>
            <div class="stat-label">T·ªïng ƒë∆°n</div>
          </div>
          <div class="stat-item">
            <div class="stat-number" id="pendingOrders">0</div>
            <div class="stat-label">Ch·ªù x·ª≠ l√Ω</div>
          </div>
          <div class="stat-item">
            <div class="stat-number" id="completedOrders">0</div>
            <div class="stat-label">ƒê√£ xong</div>
          </div>
        </div>

        <!-- Filter -->
        <div class="filter-bar">
          <button class="filter-btn active" data-filter="all">T·∫•t c·∫£</button>
          <button class="filter-btn" data-filter="pending">‚è≥ Ch·ªù x·ª≠ l√Ω</button>
          <button class="filter-btn" data-filter="completed">‚úÖ ƒê√£ xong</button>
        </div>

        <!-- Orders List -->
        <div class="orders-container" id="ordersContainer">
          <div class="loading">ƒêang t·∫£i...</div>
        </div>
      </div>
    </div>

    <!-- Order History Script (Neon PostgreSQL via Netlify Functions) -->
    <script type="module">
      let allOrders = [];
      let currentFilter = "all";

      // DOM Elements
      const ordersContainer = document.getElementById("ordersContainer");
      const totalOrdersEl = document.getElementById("totalOrders");
      const pendingOrdersEl = document.getElementById("pendingOrders");
      const completedOrdersEl = document.getElementById("completedOrders");
      const filterBtns = document.querySelectorAll(".filter-btn");

      // Filter buttons
      filterBtns.forEach((btn) => {
        btn.addEventListener("click", () => {
          filterBtns.forEach((b) => b.classList.remove("active"));
          btn.classList.add("active");
          currentFilter = btn.dataset.filter;
          renderOrders();
        });
      });

      // Status labels for display
      const statusLabels = {
        pending: "‚è≥ Ch·ªù x·ª≠ l√Ω",
        confirmed: "‚úÖ ƒê√£ x√°c nh·∫≠n",
        processing: "üîÑ ƒêang x·ª≠ l√Ω",
        completed: "‚ú® Ho√†n th√†nh",
        cancelled: "‚ùå ƒê√£ h·ªßy"
      };

      // Render orders (read-only for customers)
      function renderOrders() {
        let filteredOrders = allOrders;

        if (currentFilter !== "all") {
          filteredOrders = allOrders.filter((o) => o.status === currentFilter);
        }

        if (filteredOrders.length === 0) {
          ordersContainer.innerHTML =
            '<div class="no-orders">Kh√¥ng c√≥ ƒë∆°n h√†ng n√†o</div>';
          return;
        }

        ordersContainer.innerHTML = filteredOrders
          .map(
            (order) => `
          <div class="order-card ${order.status}">
            <div class="order-header">
              <span class="order-customer">${order.customer_name}</span>
              <span class="order-status-badge ${order.status}">
                ${statusLabels[order.status] || order.status}
              </span>
            </div>
            <div class="order-info">
              <div class="order-info-row">
                <span class="order-info-label">Lo·∫°i:</span>
                <span class="order-info-value">${
                  order.service_category === "free" ? "üéÅ Free" : "üíé Combo"
                }</span>
              </div>
              <div class="order-info-row">
                <span class="order-info-label">D·ªãch v·ª•:</span>
                <span class="order-info-value highlight">${order.service_type}</span>
              </div>
            </div>
            <div class="order-time">${new Date(order.created_at).toLocaleString(
              "vi-VN"
            )}</div>
          </div>
        `
          )
          .join("");
      }

      // Load orders from API
      async function loadOrders() {
        try {
          ordersContainer.innerHTML = '<div class="loading">ƒêang t·∫£i...</div>';
          
          const response = await fetch('/.netlify/functions/orders');
          allOrders = await response.json();

          // Update stats
          totalOrdersEl.textContent = allOrders.length;
          pendingOrdersEl.textContent = allOrders.filter(
            (o) => o.status === "pending"
          ).length;
          completedOrdersEl.textContent = allOrders.filter(
            (o) => o.status === "completed"
          ).length;

          renderOrders();
        } catch (error) {
          console.error('Error loading orders:', error);
          ordersContainer.innerHTML = '<div class="no-orders">Kh√¥ng th·ªÉ t·∫£i ƒë∆°n h√†ng. Vui l√≤ng th·ª≠ l·∫°i!</div>';
        }
      }

      // Load orders on page load
      loadOrders();
      
      // Auto refresh every 30 seconds
      setInterval(loadOrders, 30000);
    </script>
    <script src="script.js"></script>
  </body>
</html>
